{
  "config": {
    "endianness": "big_endian"
  },
  "types": {
    "DNSHeader": {
      "description": "DNS message header - fixed 12 bytes at start of all DNS messages",
      "sequence": [
        { "name": "id", "type": "uint16" },
        { "name": "qr", "type": "bit", "size": 1 },
        { "name": "opcode", "type": "bit", "size": 4 },
        { "name": "aa", "type": "bit", "size": 1 },
        { "name": "tc", "type": "bit", "size": 1 },
        { "name": "rd", "type": "bit", "size": 1 },
        { "name": "ra", "type": "bit", "size": 1 },
        { "name": "z", "type": "bit", "size": 3 },
        { "name": "rcode", "type": "bit", "size": 4 },
        { "name": "qdcount", "type": "uint16" },
        { "name": "ancount", "type": "uint16" },
        { "name": "nscount", "type": "uint16" },
        { "name": "arcount", "type": "uint16" }
      ]
    },
    "Label": {
      "description": "Single DNS label - length byte (0-63) followed by that many ASCII characters",
      "type": "string",
      "kind": "length_prefixed",
      "length_type": "uint8",
      "encoding": "ascii"
    },
    "DomainName": {
      "description": "Complete domain name - sequence of labels terminated by zero-length label",
      "type": "array",
      "kind": "null_terminated",
      "items": { "type": "Label" }
    },
    "Pointer": {
      "description": "DNS compression pointer - 2 bytes where top 2 bits are 11, followed by 14-bit offset from start of DNS message",
      "type": "uint16",
      "notes": [
        "Format: 11OOOOOO OOOOOOOO (where O = offset bits)",
        "Value is always >= 0xC000 (49152 decimal)",
        "Offset points to start of domain name elsewhere in message",
        "Allows message compression by eliminating repeated domain names"
      ]
    },
    "Question": {
      "description": "Question section entry - what is being asked",
      "sequence": [
        {
          "name": "qname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Can be a full domain name OR a compression pointer"]
        },
        { "name": "qtype", "type": "uint16" },
        { "name": "qclass", "type": "uint16" }
      ]
    },
    "ResourceRecord": {
      "description": "Resource record - answer/authority/additional section entry",
      "sequence": [
        {
          "name": "name",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Can be a full domain name OR a compression pointer (most commonly compressed)"]
        },
        { "name": "rtype", "type": "uint16" },
        { "name": "rclass", "type": "uint16" },
        { "name": "ttl", "type": "uint32" },
        { "name": "rdlength", "type": "uint16" },
        {
          "name": "rdata",
          "type": "array",
          "kind": "length_prefixed",
          "length_type": "uint16",
          "length_field": "rdlength",
          "items": { "type": "uint8" },
          "variants": ["A_Record", "NS_Record", "CNAME_Record", "SOA_Record", "PTR_Record", "MX_Record", "TXT_Record", "AAAA_Record"],
          "notes": [
            "Format depends on TYPE field:",
            "1=A_Record (IPv4 address)",
            "2=NS_Record (authoritative name server)",
            "5=CNAME_Record (canonical name for alias)",
            "6=SOA_Record (start of authority)",
            "12=PTR_Record (domain name pointer)",
            "15=MX_Record (mail exchange)",
            "16=TXT_Record (text strings)",
            "28=AAAA_Record (IPv6 address)"
          ]
        }
      ]
    },
    "A_Record": {
      "description": "A record RDATA - IPv4 address (TYPE=1, CLASS=IN)",
      "sequence": [
        { "name": "address", "type": "uint32" }
      ]
    },
    "NS_Record": {
      "description": "NS record RDATA - authoritative name server (TYPE=2)",
      "sequence": [
        {
          "name": "nsdname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Name server domain name - can be compressed"]
        }
      ]
    },
    "CNAME_Record": {
      "description": "CNAME record RDATA - canonical name for an alias (TYPE=5)",
      "sequence": [
        {
          "name": "cname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Canonical domain name - can be compressed"]
        }
      ]
    },
    "SOA_Record": {
      "description": "SOA record RDATA - start of authority (TYPE=6)",
      "sequence": [
        {
          "name": "mname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Primary name server - can be compressed"]
        },
        {
          "name": "rname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Responsible mailbox - can be compressed"]
        },
        { "name": "serial", "type": "uint32" },
        { "name": "refresh", "type": "uint32" },
        { "name": "retry", "type": "uint32" },
        { "name": "expire", "type": "uint32" },
        { "name": "minimum", "type": "uint32" }
      ]
    },
    "PTR_Record": {
      "description": "PTR record RDATA - pointer to domain name (TYPE=12)",
      "sequence": [
        {
          "name": "ptrdname",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Domain name pointer - can be compressed"]
        }
      ]
    },
    "MX_Record": {
      "description": "MX record RDATA - mail exchange (TYPE=15)",
      "sequence": [
        { "name": "preference", "type": "uint16" },
        {
          "name": "exchange",
          "type": "DomainName",
          "variants": ["DomainName", "Pointer"],
          "notes": ["Mail exchange domain name - can be compressed"]
        }
      ]
    },
    "TXT_Record": {
      "description": "TXT record RDATA - text strings (TYPE=16)",
      "type": "array",
      "kind": "length_prefixed",
      "length_type": "uint8",
      "items": { "type": "uint8" },
      "notes": [
        "One or more character-strings",
        "Each string is length-prefixed (1 byte length + data)"
      ]
    },
    "AAAA_Record": {
      "description": "AAAA record RDATA - IPv6 address (TYPE=28, CLASS=IN)",
      "sequence": [
        { "name": "address_high", "type": "uint64" },
        { "name": "address_low", "type": "uint64" }
      ]
    }
  }
}
