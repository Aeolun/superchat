{
  "config": {
    "endianness": "big_endian"
  },
  "types": {
    "DnsHeader": {
      "sequence": [
        {
          "name": "id",
          "type": "uint16",
          "description": "Transaction ID"
        },
        {
          "name": "flags",
          "type": "bitfield",
          "size": 16,
          "fields": [
            {
              "name": "qr",
              "offset": 0,
              "size": 1,
              "description": "Query/Response flag (0=Query, 1=Response)"
            },
            {
              "name": "opcode",
              "offset": 1,
              "size": 4,
              "description": "Operation code (0=QUERY, 1=IQUERY, 2=STATUS, 3-15 reserved)"
            },
            {
              "name": "aa",
              "offset": 5,
              "size": 1,
              "description": "Authoritative Answer"
            },
            {
              "name": "tc",
              "offset": 6,
              "size": 1,
              "description": "Truncation"
            },
            {
              "name": "rd",
              "offset": 7,
              "size": 1,
              "description": "Recursion Desired"
            },
            {
              "name": "ra",
              "offset": 8,
              "size": 1,
              "description": "Recursion Available"
            },
            {
              "name": "z",
              "offset": 9,
              "size": 3,
              "description": "Reserved (must be zero)"
            },
            {
              "name": "rcode",
              "offset": 12,
              "size": 4,
              "description": "Response code"
            }
          ],
          "description": "DNS flags per RFC 1035 Section 4.1.1"
        },
        {
          "name": "qdcount",
          "type": "uint16",
          "description": "Number of questions"
        },
        {
          "name": "ancount",
          "type": "uint16",
          "description": "Number of answers"
        },
        {
          "name": "nscount",
          "type": "uint16",
          "description": "Number of authority records"
        },
        {
          "name": "arcount",
          "type": "uint16",
          "description": "Number of additional records"
        }
      ]
    },
    "Label": {
      "type": "string",
      "kind": "length_prefixed",
      "length_type": "uint8",
      "encoding": "ascii",
      "description": "DNS label (length-prefixed ASCII string)"
    },
    "CompressedLabel": {
      "type": "discriminated_union",
      "discriminator": {
        "peek": "uint8"
      },
      "variants": [
        {
          "type": "Label",
          "when": "value < 0xC0"
        },
        {
          "type": "LabelPointer",
          "when": "value >= 0xC0"
        }
      ],
      "description": "DNS label or pointer to previous label"
    },
    "LabelPointer": {
      "type": "back_reference",
      "storage": "uint16",
      "endianness": "big_endian",
      "offset_mask": "0x3FFF",
      "offset_from": "message_start",
      "target_type": "Label",
      "description": "Pointer to previously-seen label (RFC 1035 Section 4.1.4)"
    },
    "CompressedDomain": {
      "type": "array",
      "kind": "null_terminated",
      "items": {
        "type": "CompressedLabel"
      },
      "terminal_variants": ["LabelPointer"],
      "description": "Sequence of labels or pointers (pointers are terminal per RFC 1035)"
    },
    "Question": {
      "sequence": [
        {
          "name": "qname",
          "type": "CompressedDomain",
          "description": "Query domain name"
        },
        {
          "name": "qtype",
          "type": "uint16",
          "description": "Query type (1=A, 2=NS, 5=CNAME, etc.)"
        },
        {
          "name": "qclass",
          "type": "uint16",
          "description": "Query class (1=IN for Internet)"
        }
      ],
      "description": "DNS Question section entry (RFC 1035 Section 4.1.2)"
    },
    "ARdata": {
      "sequence": [
        {
          "name": "address",
          "type": "uint32",
          "description": "IPv4 address (4 bytes)"
        }
      ],
      "description": "A record RDATA (TYPE=1, CLASS=1) - IPv4 address"
    },
    "ResourceRecord": {
      "sequence": [
        {
          "name": "name",
          "type": "CompressedDomain",
          "description": "Domain name (may use compression pointers)"
        },
        {
          "name": "type",
          "type": "uint16",
          "description": "RR type (1=A, 2=NS, 5=CNAME, etc.)"
        },
        {
          "name": "class",
          "type": "uint16",
          "description": "RR class (1=IN for Internet)"
        },
        {
          "name": "ttl",
          "type": "uint32",
          "description": "Time to live (seconds)"
        },
        {
          "name": "rdlength",
          "type": "uint16",
          "description": "Length of RDATA in bytes"
        },
        {
          "name": "rdata",
          "type": "discriminated_union",
          "discriminator": {
            "field": "type"
          },
          "variants": [
            {
              "type": "ARdata",
              "when": "value === 1",
              "description": "A record (IPv4 address)"
            }
          ],
          "description": "Resource data (format depends on TYPE)"
        }
      ],
      "description": "DNS Resource Record (RFC 1035 Section 4.1.3)"
    },
    "DnsQuery": {
      "sequence": [
        {
          "name": "questions",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "qdcount",
          "items": { "type": "Question" },
          "description": "Questions (length from header qdcount)"
        }
      ],
      "description": "DNS Query payload (questions only)"
    },
    "DnsResponse": {
      "sequence": [
        {
          "name": "questions",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "qdcount",
          "items": { "type": "Question" },
          "description": "Questions (length from header qdcount)"
        },
        {
          "name": "answers",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "ancount",
          "items": { "type": "ResourceRecord" },
          "description": "Answers (length from header ancount)"
        },
        {
          "name": "authority",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "nscount",
          "items": { "type": "ResourceRecord" },
          "description": "Authority records (length from header nscount)"
        },
        {
          "name": "additional",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "arcount",
          "items": { "type": "ResourceRecord" },
          "description": "Additional records (length from header arcount)"
        }
      ],
      "description": "DNS Response payload (questions + answers + authority + additional)"
    }
  }
}
