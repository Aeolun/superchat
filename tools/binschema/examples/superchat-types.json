{
  "config": {
    "endianness": "big_endian"
  },
  "types": {
    "String": {
      "description": "Length-prefixed UTF-8 string",
      "fields": [
        {
          "name": "data",
          "type": "array",
          "kind": "length_prefixed",
          "length_type": "uint16",
          "items": { "type": "uint8" }
        }
      ]
    },
    "Optional<T>": {
      "description": "Optional field with presence byte",
      "fields": [
        { "name": "present", "type": "uint8" },
        { "name": "value", "type": "T", "conditional": "present == 1" }
      ]
    },
    "FrameHeader": {
      "description": "All messages use this frame format",
      "fields": [
        { "name": "length", "type": "uint32" },
        { "name": "version", "type": "uint8" },
        { "name": "type", "type": "uint8" },
        { "name": "flags", "type": "uint8" }
      ]
    },
    "AuthRequest": {
      "description": "Authentication request with password",
      "fields": [
        { "name": "nickname", "type": "String" },
        { "name": "password", "type": "String" }
      ]
    },
    "AuthResponse": {
      "description": "Authentication response",
      "fields": [
        { "name": "success", "type": "uint8" },
        { "name": "user_id", "type": "Optional<uint64>" },
        { "name": "nickname", "type": "Optional<String>" },
        { "name": "message", "type": "String" }
      ]
    },
    "SetNickname": {
      "description": "Set or change nickname",
      "fields": [
        { "name": "nickname", "type": "String" }
      ]
    },
    "NicknameResponse": {
      "description": "Nickname change result",
      "fields": [
        { "name": "success", "type": "uint8" },
        { "name": "nickname", "type": "String" },
        { "name": "message", "type": "String" }
      ]
    },
    "PostMessage": {
      "description": "Post a new message",
      "fields": [
        { "name": "channel_id", "type": "uint64" },
        { "name": "parent_id", "type": "Optional<uint64>" },
        { "name": "content", "type": "String" }
      ]
    },
    "MessagePosted": {
      "description": "Message post confirmation",
      "fields": [
        { "name": "success", "type": "uint8" },
        { "name": "message_id", "type": "uint64" },
        { "name": "error", "type": "Optional<String>" }
      ]
    },
    "NewMessage": {
      "description": "Real-time message notification",
      "fields": [
        { "name": "message_id", "type": "uint64" },
        { "name": "channel_id", "type": "uint64" },
        { "name": "parent_id", "type": "Optional<uint64>" },
        { "name": "author", "type": "String" },
        { "name": "content", "type": "String" },
        { "name": "created_at", "type": "int64" }
      ]
    }
  }
}
