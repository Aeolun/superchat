{
  "config": {
    "endianness": "little_endian"
  },
  "types": {
    "ZipArchive": {
      "sequence": [
        {
          "name": "sections",
          "type": "array",
          "kind": "eof_terminated",
          "items": { "type": "PkSection" }
        }
      ]
    },

    "PkSection": {
      "sequence": [
        { "name": "magic", "type": "uint16", "description": "Always 'PK' (0x4b50)" },
        { "name": "section_type", "type": "uint16" },
        {
          "name": "body",
          "type": "discriminated_union",
          "discriminator": { "field": "section_type" },
          "variants": [
            { "when": "value == 0x0201", "type": "CentralDirEntry", "description": "Central directory entry" },
            { "when": "value == 0x0403", "type": "LocalFile", "description": "Local file header + data" },
            { "when": "value == 0x0605", "type": "EndOfCentralDir", "description": "End of central directory" },
            { "when": "value == 0x0807", "type": "DataDescriptor", "description": "Data descriptor" }
          ]
        }
      ]
    },

    "DataDescriptor": {
      "sequence": [
        { "name": "crc32", "type": "uint32" },
        { "name": "len_body_compressed", "type": "uint32" },
        { "name": "len_body_uncompressed", "type": "uint32" }
      ]
    },

    "LocalFile": {
      "sequence": [
        { "name": "header", "type": "LocalFileHeader" },
        {
          "name": "body",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "header.len_body_compressed",
          "items": { "type": "uint8" }
        }
      ]
    },

    "LocalFileHeader": {
      "sequence": [
        { "name": "version", "type": "uint16" },
        { "name": "flags", "type": "uint16" },
        { "name": "compression_method", "type": "uint16" },
        { "name": "file_mod_time", "type": "uint32", "description": "DOS datetime" },
        { "name": "crc32", "type": "uint32" },
        { "name": "len_body_compressed", "type": "uint32" },
        { "name": "len_body_uncompressed", "type": "uint32" },
        { "name": "len_file_name", "type": "uint16" },
        { "name": "len_extra", "type": "uint16" },
        {
          "name": "file_name",
          "type": "string",
          "kind": "field_referenced",
          "length_field": "len_file_name",
          "encoding": "utf8"
        },
        {
          "name": "extra",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "len_extra",
          "items": { "type": "uint8" }
        }
      ]
    },

    "CentralDirEntry": {
      "sequence": [
        { "name": "version_made_by", "type": "uint16" },
        { "name": "version_needed_to_extract", "type": "uint16" },
        { "name": "flags", "type": "uint16" },
        { "name": "compression_method", "type": "uint16" },
        { "name": "file_mod_time", "type": "uint32", "description": "DOS datetime" },
        { "name": "crc32", "type": "uint32" },
        { "name": "len_body_compressed", "type": "uint32" },
        { "name": "len_body_uncompressed", "type": "uint32" },
        { "name": "len_file_name", "type": "uint16" },
        { "name": "len_extra", "type": "uint16" },
        { "name": "len_comment", "type": "uint16" },
        { "name": "disk_number_start", "type": "uint16" },
        { "name": "int_file_attr", "type": "uint16" },
        { "name": "ext_file_attr", "type": "uint32" },
        { "name": "ofs_local_header", "type": "uint32" },
        {
          "name": "file_name",
          "type": "string",
          "kind": "field_referenced",
          "length_field": "len_file_name",
          "encoding": "utf8"
        },
        {
          "name": "extra",
          "type": "array",
          "kind": "field_referenced",
          "length_field": "len_extra",
          "items": { "type": "uint8" }
        },
        {
          "name": "comment",
          "type": "string",
          "kind": "field_referenced",
          "length_field": "len_comment",
          "encoding": "utf8"
        }
      ]
    },

    "EndOfCentralDir": {
      "sequence": [
        { "name": "disk_of_end_of_central_dir", "type": "uint16" },
        { "name": "disk_of_central_dir", "type": "uint16" },
        { "name": "num_central_dir_entries_on_disk", "type": "uint16" },
        { "name": "num_central_dir_entries_total", "type": "uint16" },
        { "name": "len_central_dir", "type": "uint32" },
        { "name": "ofs_central_dir", "type": "uint32" },
        { "name": "len_comment", "type": "uint16" },
        {
          "name": "comment",
          "type": "string",
          "kind": "field_referenced",
          "length_field": "len_comment",
          "encoding": "utf8"
        }
      ]
    }
  }
}
